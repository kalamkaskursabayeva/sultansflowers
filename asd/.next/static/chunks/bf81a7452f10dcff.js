(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97873,e=>{"use strict";var t=e.i(94606),r=e.i(23952);function a({className:e,type:a,...s}){return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}e.s(["Input",()=>a])},5900,e=>{"use strict";var t=e.i(62415);let r=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:n="",children:d,iconNode:o,...c},u)=>(0,t.createElement)("svg",{ref:u,...a,width:s,height:s,stroke:e,strokeWidth:l?24*Number(i)/Number(s):i,className:r("lucide",n),...c},[...o.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(d)?d:[d]])),i=(e,a)=>{let i=(0,t.forwardRef)(({className:i,...l},n)=>(0,t.createElement)(s,{ref:n,iconNode:a,className:r(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,i),...l}));return i.displayName=`${e}`,i};e.s(["default",()=>i],5900)},81218,e=>{"use strict";let t=(0,e.i(5900).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],81218)},34378,e=>{"use strict";let t=(0,e.i(5900).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>t],34378)},9791,e=>{"use strict";let t=(0,e.i(5900).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],9791)},69413,e=>{"use strict";var t=e.i(94606),r=e.i(62415),a=e.i(35124);let s=e.i(25482).default.env.NEXT_PUBLIC_API_URL||"http://localhost:5000/api",i=new class{async getTrucks(e=1,t=10,r){let a=new URLSearchParams({page:e.toString(),limit:t.toString(),sortBy:r?.sortBy||"arrival_date",order:r?.order||"DESC"});r?.identifier&&a.append("identifier",r.identifier),r?.dateFrom&&a.append("dateFrom",r.dateFrom),r?.dateTo&&a.append("dateTo",r.dateTo),r?.status&&a.append("status",r.status);let i=await fetch(`${s}/trucks?${a}`,{credentials:"include"});if(!i.ok)throw Error("Failed to fetch trucks");return i.json()}async getTruck(e){let t=await fetch(`${s}/trucks/${e}`,{credentials:"include"});if(!t.ok)throw Error("Failed to fetch truck");return t.json()}async createTruck(e){let t=await fetch(`${s}/trucks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok)throw Error("Failed to create truck");return t.json()}async updateTruck(e,t){let r=await fetch(`${s}/trucks/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!r.ok)throw Error("Failed to update truck");return r.json()}async deleteTruck(e){let t=await fetch(`${s}/trucks/${e}`,{method:"DELETE",credentials:"include"});if(!t.ok)throw Error("Failed to delete truck");return t.json()}async getAnalyticsSummary(){let e=await fetch(`${s}/trucks/analytics/summary`,{credentials:"include"});if(!e.ok)throw Error("Failed to fetch analytics");return e.json()}async getAnalyticsByDate(e,t){let r=new URLSearchParams;e&&r.append("dateFrom",e),t&&r.append("dateTo",t);let a=await fetch(`${s}/trucks/analytics/by-date?${r}`,{credentials:"include"});if(!a.ok)throw Error("Failed to fetch analytics by date");return a.json()}async exportToExcel(e){let t=new URLSearchParams;e?.identifier&&t.append("identifier",e.identifier),e?.dateFrom&&t.append("dateFrom",e.dateFrom),e?.dateTo&&t.append("dateTo",e.dateTo),e?.status&&t.append("status",e.status);let r=await fetch(`${s}/trucks/export/excel?${t}`,{credentials:"include"});if(!r.ok)throw Error("Failed to export");let a=await r.blob(),i=window.URL.createObjectURL(a),l=document.createElement("a");l.href=i,l.download=`trucks-${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(i),document.body.removeChild(l)}};var l=e.i(63918),n=e.i(97873),d=e.i(9791);let o=(0,e.i(5900).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var c=e.i(81218),u=e.i(34378);function x(){let[e,s]=(0,r.useState)([]),[x,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)(1),[y,v]=(0,r.useState)(1),[j,f]=(0,r.useState)(""),[w,k]=(0,r.useState)(""),[N,C]=(0,r.useState)(""),[T,S]=(0,r.useState)(""),[E,L]=(0,r.useState)(!1),[B,_]=(0,r.useState)(null),[$,F]=(0,r.useState)({identifier:"",arrival_date:"",status:"pending",notes:"",metrics:[]});(0,r.useEffect)(()=>{M(),D()},[p,j,w,N,T]);let M=async()=>{try{g(!0);let e=await i.getTrucks(p,10,{identifier:j,dateFrom:w,dateTo:N,status:T,sortBy:"arrival_date",order:"DESC"});s(e.data),v(e.pagination.pages)}catch(e){console.error("Error loading trucks:",e)}finally{g(!1)}},D=async()=>{try{let e=await i.getAnalyticsSummary();m(e.data)}catch(e){console.error("Error loading analytics:",e)}},I=e=>{e?(_(e.id),F({identifier:e.identifier,arrival_date:e.arrival_date,status:e.status,notes:e.notes||"",metrics:e.metrics||[]})):(_(null),F({identifier:"",arrival_date:"",status:"pending",notes:"",metrics:[]})),L(!0)},P=async e=>{e.preventDefault();try{B?(await i.updateTruck(B,$),alert("Фура обновлена")):(await i.createTruck($),alert("Фура добавлена")),L(!1),b(1),M(),D()}catch(e){console.error("Error submitting:",e),alert("Ошибка при сохранении: "+(e instanceof Error?e.message:"Unknown error"))}},R=async e=>{if(confirm("Вы уверены, что хотите удалить эту фуру?"))try{await i.deleteTruck(e),alert("Фура удалена"),M(),D()}catch(e){console.error("Error deleting:",e),alert("Ошибка при удалении")}},U=(e,t,r)=>{let a=[...$.metrics];a[e]={...a[e],[t]:r},F({...$,metrics:a})};return(0,t.jsxs)(a.DashboardLayout,{title:"Анализ фур",requiredRole:"admin",children:[x&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Всего фур"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:x.total_trucks})]}),(0,t.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Доставлено"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-1",children:x.delivered})]}),(0,t.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"В пути"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:x.in_transit})]}),(0,t.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"})})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Задержано"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-red-600 mt-1",children:x.delayed})]}),(0,t.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})]})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 mb-4",children:[(0,t.jsx)(n.Input,{placeholder:"Поиск по ID фуры...",value:j,onChange:e=>f(e.target.value),className:"max-w-xs"}),(0,t.jsx)(n.Input,{type:"date",value:w,onChange:e=>k(e.target.value),className:"max-w-xs"}),(0,t.jsx)(n.Input,{type:"date",value:N,onChange:e=>C(e.target.value),className:"max-w-xs"}),(0,t.jsxs)("select",{value:T,onChange:e=>S(e.target.value),className:"px-3 py-2 border border-input rounded-md bg-background",children:[(0,t.jsx)("option",{value:"",children:"Все статусы"}),(0,t.jsx)("option",{value:"pending",children:"Ожидание"}),(0,t.jsx)("option",{value:"in_transit",children:"В пути"}),(0,t.jsx)("option",{value:"delivered",children:"Доставлена"}),(0,t.jsx)("option",{value:"delayed",children:"Задержана"})]}),(0,t.jsx)(l.Button,{onClick:()=>{f(""),k(""),C(""),S(""),b(1)},variant:"outline",children:"Очистить"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(l.Button,{onClick:()=>I(),className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(c.Plus,{className:"w-4 h-4 mr-2"}),"Добавить фуру"]}),(0,t.jsxs)(l.Button,{onClick:()=>i.exportToExcel({identifier:j,dateFrom:w,dateTo:N,status:T}),variant:"outline",children:[(0,t.jsx)(u.Download,{className:"w-4 h-4 mr-2"}),"Экспорт в Excel"]})]})]}),(0,t.jsx)("div",{className:"space-y-4",children:h?(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center text-gray-500",children:"Загрузка..."}):0===e.length?(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center text-gray-500",children:"Фуры не найдены"}):e.map(e=>{var r;return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,t.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-start justify-between gap-4 mb-4",children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Фура #",e.identifier]}),(0,t.jsx)("span",{className:`px-2 py-1 text-xs rounded-full ${{pending:"bg-yellow-100 text-yellow-700",in_transit:"bg-blue-100 text-blue-700",delivered:"bg-green-100 text-green-700",delayed:"bg-red-100 text-red-700"}[e.status]||"bg-gray-100 text-gray-700"}`,children:{pending:"Ожидание",in_transit:"В пути",delivered:"Доставлена",delayed:"Задержана"}[r=e.status]||r})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Дата прибытия:"," ",new Date(e.arrival_date).toLocaleDateString("ru-RU")]}),e.notes&&(0,t.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:["Примечание: ",e.notes]}),e.created_by_name&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Создано: ",e.created_by_name]})]})}),e.metrics&&e.metrics.length>0&&(0,t.jsxs)("div",{className:"border-t border-gray-100 pt-4 mb-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Показатели:"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:e.metrics.map((e,r)=>(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsxs)("span",{className:"text-gray-600",children:[e.name,": ",(0,t.jsx)("strong",{children:e.value})," ",e.unit||""]})},r))})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[(0,t.jsxs)(l.Button,{size:"sm",onClick:()=>I(e),variant:"outline",className:"text-blue-600 border-blue-600",children:[(0,t.jsx)(o,{className:"w-4 h-4 mr-2"}),"Редактировать"]}),(0,t.jsxs)(l.Button,{size:"sm",onClick:()=>R(e.id),variant:"outline",className:"text-red-600 border-red-600",children:[(0,t.jsx)(d.Trash2,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]},e.id)})}),y>1&&(0,t.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,t.jsx)(l.Button,{onClick:()=>b(Math.max(1,p-1)),disabled:1===p,variant:"outline",children:"◀ Назад"}),(0,t.jsxs)("span",{className:"px-4 py-2 text-sm",children:["Страница ",p," из ",y]}),(0,t.jsx)(l.Button,{onClick:()=>b(Math.min(y,p+1)),disabled:p===y,variant:"outline",children:"Далее ▶"})]}),E&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:B?"Редактировать фуру":"Новая фура"}),(0,t.jsx)("button",{onClick:()=>L(!1),className:"text-gray-500 hover:text-gray-700 text-2xl leading-none",children:"✕"})]}),(0,t.jsxs)("form",{onSubmit:P,className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID фуры *"}),(0,t.jsx)(n.Input,{type:"text",required:!0,value:$.identifier,onChange:e=>F({...$,identifier:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата прибытия *"}),(0,t.jsx)(n.Input,{type:"date",required:!0,value:$.arrival_date,onChange:e=>F({...$,arrival_date:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Статус *"}),(0,t.jsxs)("select",{required:!0,value:$.status,onChange:e=>F({...$,status:e.target.value}),className:"w-full px-3 py-2 border border-input rounded-md bg-background",children:[(0,t.jsx)("option",{value:"pending",children:"Ожидание"}),(0,t.jsx)("option",{value:"in_transit",children:"В пути"}),(0,t.jsx)("option",{value:"delivered",children:"Доставлена"}),(0,t.jsx)("option",{value:"delayed",children:"Задержана"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Примечания"}),(0,t.jsx)("textarea",{value:$.notes,onChange:e=>F({...$,notes:e.target.value}),className:"w-full px-3 py-2 border border-input rounded-md min-h-24 resize-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Показатели доставки"}),(0,t.jsx)("div",{className:"space-y-3 mb-3",children:$.metrics.map((e,r)=>(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-2",children:[(0,t.jsx)(n.Input,{type:"text",placeholder:"Название (кол-во, ассортимент...)",value:e.name,onChange:e=>U(r,"name",e.target.value)}),(0,t.jsx)(n.Input,{type:"text",placeholder:"Значение",value:e.value,onChange:e=>U(r,"value",e.target.value)}),(0,t.jsx)(n.Input,{type:"text",placeholder:"Единица (шт, кг...)",value:e.unit,onChange:e=>U(r,"unit",e.target.value)})]}),(0,t.jsx)(l.Button,{type:"button",size:"sm",onClick:()=>{F({...$,metrics:$.metrics.filter((e,t)=>t!==r)})},variant:"outline",className:"text-red-600 border-red-600",children:"Удалить показатель"})]},r))}),(0,t.jsxs)(l.Button,{type:"button",onClick:()=>{F({...$,metrics:[...$.metrics,{name:"",value:"",unit:""}]})},variant:"outline",className:"w-full",children:[(0,t.jsx)(c.Plus,{className:"w-4 h-4 mr-2"}),"Добавить показатель"]})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end pt-4 border-t border-gray-200",children:[(0,t.jsx)(l.Button,{type:"button",onClick:()=>L(!1),variant:"outline",children:"Отмена"}),(0,t.jsx)(l.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:B?"Сохранить":"Создать"})]})]})]})})]})}e.s(["default",()=>x],69413)}]);