module.exports=[84166,a=>{"use strict";var b=a.i(15477),c=a.i(47519),d=a.i(63183),e=a.i(82383),f=a.i(72063),g=a.i(19238),h=a.i(35321),i=a.i(54323),j=a.i(22800),k=a.i(62490),l=a.i(23649),m=a.i(33953);let n=(0,m.default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var o=a.i(63893);let p=(0,m.default)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),q=(0,m.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var r=a.i(36086),s=a.i(47781),t=a.i(96781);let u=(0,m.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var v=a.i(68357);let w=(0,m.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),x=(0,m.default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var y=a.i(43438);function z(){let{user:a}=(0,d.useAuth)(),m=(0,e.useRouter)(),z=a=>String(a).padStart(2,"0"),A=a=>`${a.getFullYear()}-${z(a.getMonth()+1)}-${z(a.getDate())}`,[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(new Date),[F,G]=(0,c.useState)({}),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)({eventDate:A(new Date),title:"",description:"",eventType:"custom",priority:"medium"});(0,c.useEffect)(()=>{a&&["admin","worker"].includes(a.role)?V():m.push("/auth/login")},[a,D]);let V=async()=>{try{C(!0);let a=D.getFullYear(),b=D.getMonth()+1,[c,d]=await Promise.all([f.api.getCalendarMonthEvents(a,b),f.api.getAnalyticsSummary({})]);c.success&&G(c.events),d.success&&M(d)}catch(a){console.error("Error loading calendar data:",a)}finally{C(!1)}},W=async()=>{try{let a=await f.api.getAnalyticsThresholds();a.success&&O(a.thresholds)}catch(a){console.error("Error loading thresholds:",a)}},X=async()=>{try{(await f.api.createCalendarEvent({userId:a.id,eventDate:T.eventDate,title:T.title,description:T.description,eventType:T.eventType,priority:T.priority})).success&&(S(!1),U({eventDate:A(new Date),title:"",description:"",eventType:"custom",priority:"medium"}),V())}catch(a){console.error("Error creating event:",a)}},Y=async a=>{try{if(await f.api.markEventAsRead(a),V(),H){let b=J.map(b=>b.id===a?{...b,is_read:!0}:b);K(b)}}catch(a){console.error("Error marking as read:",a)}},Z=async()=>{try{let b=await f.api.generateCalendarEvents(a.id);b.success&&(alert(`Создано ${b.eventsCreated} событий`),V())}catch(a){console.error("Error generating events:",a)}},$=async(b,c)=>{try{await f.api.updateAnalyticsThreshold(b,{userId:a.id,value:c}),W()}catch(a){console.error("Error updating threshold:",a)}},_=a=>{switch(a){case"high_sales":return(0,b.jsx)(r.TrendingUp,{className:"h-3 w-3 text-green-600"});case"low_sales":return(0,b.jsx)(s.TrendingDown,{className:"h-3 w-3 text-red-600"});case"large_discount":return(0,b.jsx)(u,{className:"h-3 w-3 text-orange-600"});case"inventory_received":return(0,b.jsx)(t.Package,{className:"h-3 w-3 text-blue-600"});case"price_change":return(0,b.jsx)(r.TrendingUp,{className:"h-3 w-3 text-purple-600"});case"stock_alert":return(0,b.jsx)(u,{className:"h-3 w-3 text-red-600"});default:return(0,b.jsx)(v.Calendar,{className:"h-3 w-3 text-gray-600"})}},aa=a=>{switch(a){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";default:return"bg-gray-400"}},ab=A(new Date);return B?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-[#568a56] border-t-transparent rounded-full"})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(y.default,{href:"/admin",className:"text-gray-600 hover:text-gray-900",children:(0,b.jsx)(l.ChevronLeft,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Календарь аналитики"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Важные события и уведомления"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[L&&L.unreadImportantEvents>0&&(0,b.jsxs)(k.Badge,{className:"bg-red-500 text-white",children:[(0,b.jsx)(p,{className:"h-3 w-3 mr-1"}),L.unreadImportantEvents," непрочитанных"]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:Z,children:[(0,b.jsx)(w,{className:"h-4 w-4 mr-2"}),"Обновить события"]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>{W(),Q(!0)},children:[(0,b.jsx)(q,{className:"h-4 w-4 mr-2"}),"Настройки"]}),(0,b.jsxs)(j.Dialog,{open:R,onOpenChange:S,children:[(0,b.jsx)(j.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"bg-[#568a56] hover:bg-[#467046]",children:[(0,b.jsx)(o.Plus,{className:"h-4 w-4 mr-2"}),"Добавить событие"]})}),(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Новое событие"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Дата"}),(0,b.jsx)(h.Input,{type:"date",value:T.eventDate,onChange:a=>U(b=>({...b,eventDate:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Заголовок"}),(0,b.jsx)(h.Input,{placeholder:"Название события",value:T.title,onChange:a=>U(b=>({...b,title:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Описание"}),(0,b.jsx)(h.Input,{placeholder:"Подробности",value:T.description,onChange:a=>U(b=>({...b,description:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Приоритет"}),(0,b.jsxs)("select",{className:"w-full border rounded p-2",value:T.priority,onChange:a=>U(b=>({...b,priority:a.target.value})),children:[(0,b.jsx)("option",{value:"low",children:"Низкий"}),(0,b.jsx)("option",{value:"medium",children:"Средний"}),(0,b.jsx)("option",{value:"high",children:"Высокий"}),(0,b.jsx)("option",{value:"critical",children:"Критичный"})]})]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>S(!1),children:"Отмена"}),(0,b.jsx)(g.Button,{onClick:X,className:"bg-[#568a56] hover:bg-[#467046]",children:"Создать"})]})]})]})]})]})})}),(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[L&&(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:[Number(L.shifts.total_sales||0).toLocaleString()," тг"]}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Продажи за период"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:L.shifts.total_shifts||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Закрытых смен"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:L.inventory.total_batches||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Партий товара"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:L.shifts.total_orders||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Заказов"})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(g.Button,{variant:"ghost",onClick:()=>{E(new Date(D.getFullYear(),D.getMonth()-1,1))},children:(0,b.jsx)(l.ChevronLeft,{className:"h-5 w-5"})}),(0,b.jsxs)(i.CardTitle,{children:[["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][D.getMonth()]," ",D.getFullYear()]}),(0,b.jsx)(g.Button,{variant:"ghost",onClick:()=>{E(new Date(D.getFullYear(),D.getMonth()+1,1))},children:(0,b.jsx)(n,{className:"h-5 w-5"})})]})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].map(a=>(0,b.jsx)("div",{className:"text-center text-sm font-medium text-gray-600 py-2",children:a},a))}),(0,b.jsx)("div",{className:"grid grid-cols-7 gap-1",children:(()=>{let a=D.getFullYear(),b=D.getMonth(),c=new Date(a,b,1),d=new Date(a,b+1,0).getDate(),e=c.getDay()||7,f=[];for(let c=e-1;c>0;c--){let d=new Date(a,b,1-c);f.push({date:A(d),day:d.getDate(),isCurrentMonth:!1})}for(let c=1;c<=d;c++){let d=new Date(a,b,c);f.push({date:A(d),day:c,isCurrentMonth:!0})}let g=42-f.length;for(let c=1;c<=g;c++){let d=new Date(a,b+1,c);f.push({date:A(d),day:c,isCurrentMonth:!1})}return f})().map((a,c)=>{let d=F[a.date]||[],e=d.length>0,f=d.some(a=>!a.is_read),g=d.some(a=>["high","critical"].includes(a.priority));return(0,b.jsxs)("div",{onClick:()=>{var b;return a.isCurrentMonth&&void(I(b=a.date),K(F[b]||[]))},className:`
                          min-h-20 p-1 border rounded cursor-pointer transition-colors
                          ${a.isCurrentMonth?"bg-white hover:bg-gray-50":"bg-gray-50 text-gray-400"}
                          ${a.date===ab?"border-[#568a56] border-2":"border-gray-200"}
                          ${H===a.date?"ring-2 ring-[#568a56]":""}
                        `,children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsx)("span",{className:`text-sm font-medium ${a.date===ab?"text-[#568a56]":""}`,children:a.day}),f&&(0,b.jsx)("span",{className:`w-2 h-2 rounded-full ${g?"bg-red-500":"bg-orange-500"}`})]}),e&&a.isCurrentMonth&&(0,b.jsxs)("div",{className:"mt-1 space-y-0.5",children:[d.slice(0,3).map((a,c)=>(0,b.jsxs)("div",{className:`flex items-center gap-1 text-xs truncate ${a.is_read?"opacity-60":""}`,children:[(0,b.jsx)("span",{className:`w-1.5 h-1.5 rounded-full ${aa(a.priority)}`}),_(a.event_type)]},c)),d.length>3&&(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["+",d.length-3]})]})]},c)})})]})]})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(i.Card,{className:"sticky top-4",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:H?`События: ${(a=>{let[b,c,d]=a.split("-").map(Number);return new Date(b,c-1,d)})(H).toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}`:"Выберите день"})}),(0,b.jsx)(i.CardContent,{children:J.length>0?(0,b.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:J.map(a=>{var c;return(0,b.jsxs)("div",{className:`p-3 rounded-lg border ${a.is_read?"bg-gray-50":"bg-white border-l-4 border-l-"+aa(a.priority).replace("bg-","")}`,children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[_(a.event_type),(0,b.jsx)("span",{className:"font-medium text-sm",children:a.title})]}),!a.is_read&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>Y(a.id),className:"h-6 w-6 p-0",children:(0,b.jsx)(x,{className:"h-4 w-4"})})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(c=a.priority,(0,b.jsx)(k.Badge,{className:{critical:"bg-red-100 text-red-800",high:"bg-orange-100 text-orange-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-gray-100 text-gray-800"}[c],children:{critical:"Критично",high:"Высокий",medium:"Средний",low:"Низкий"}[c]})),a.is_auto_generated&&(0,b.jsx)(k.Badge,{variant:"outline",className:"text-xs",children:"Авто"})]})]},a.id)})}):H?(0,b.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Нет событий в этот день"}):(0,b.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Кликните на день для просмотра событий"})})]}),(0,b.jsxs)(i.Card,{className:"mt-4",children:[(0,b.jsx)(i.CardHeader,{className:"py-3",children:(0,b.jsx)(i.CardTitle,{className:"text-sm",children:"Типы событий"})}),(0,b.jsx)(i.CardContent,{className:"py-2",children:(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.TrendingUp,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)("span",{children:"Высокие продажи"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s.TrendingDown,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)("span",{children:"Низкие продажи"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u,{className:"h-4 w-4 text-orange-600"}),(0,b.jsx)("span",{children:"Большие скидки / Низкий остаток"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Package,{className:"h-4 w-4 text-blue-600"}),(0,b.jsx)("span",{children:"Поставка товара"})]})]})})]})]})]})]}),(0,b.jsx)(j.Dialog,{open:P,onOpenChange:Q,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-lg",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Настройки пороговых значений"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Система автоматически создаст события в календаре при достижении этих значений"}),N.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.description}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.threshold_type})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(h.Input,{type:"number",className:"w-32",value:a.threshold_value,onChange:b=>$(a.threshold_type,Number(b.target.value))})})]},a.id))]}),(0,b.jsx)(j.DialogFooter,{children:(0,b.jsx)(g.Button,{onClick:()=>Q(!1),children:"Закрыть"})})]})})]})}a.s(["default",()=>z],84166)}];

//# sourceMappingURL=sdfg_app_admin_calendar_page_tsx_83ad7c1b._.js.map