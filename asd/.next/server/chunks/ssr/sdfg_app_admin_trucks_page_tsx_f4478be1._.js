module.exports=[12816,a=>{"use strict";var b=a.i(15477),c=a.i(47519),d=a.i(32688);let e=process.env.NEXT_PUBLIC_API_URL||"http://localhost:5000/api",f=new class{async getTrucks(a=1,b=10,c){let d=new URLSearchParams({page:a.toString(),limit:b.toString(),sortBy:c?.sortBy||"arrival_date",order:c?.order||"DESC"});c?.identifier&&d.append("identifier",c.identifier),c?.dateFrom&&d.append("dateFrom",c.dateFrom),c?.dateTo&&d.append("dateTo",c.dateTo),c?.status&&d.append("status",c.status);let f=await fetch(`${e}/trucks?${d}`,{credentials:"include"});if(!f.ok)throw Error("Failed to fetch trucks");return f.json()}async getTruck(a){let b=await fetch(`${e}/trucks/${a}`,{credentials:"include"});if(!b.ok)throw Error("Failed to fetch truck");return b.json()}async createTruck(a){let b=await fetch(`${e}/trucks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!b.ok)throw Error("Failed to create truck");return b.json()}async updateTruck(a,b){let c=await fetch(`${e}/trucks/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),credentials:"include"});if(!c.ok)throw Error("Failed to update truck");return c.json()}async deleteTruck(a){let b=await fetch(`${e}/trucks/${a}`,{method:"DELETE",credentials:"include"});if(!b.ok)throw Error("Failed to delete truck");return b.json()}async getAnalyticsSummary(){let a=await fetch(`${e}/trucks/analytics/summary`,{credentials:"include"});if(!a.ok)throw Error("Failed to fetch analytics");return a.json()}async getAnalyticsByDate(a,b){let c=new URLSearchParams;a&&c.append("dateFrom",a),b&&c.append("dateTo",b);let d=await fetch(`${e}/trucks/analytics/by-date?${c}`,{credentials:"include"});if(!d.ok)throw Error("Failed to fetch analytics by date");return d.json()}async exportToExcel(a){let b=new URLSearchParams;a?.identifier&&b.append("identifier",a.identifier),a?.dateFrom&&b.append("dateFrom",a.dateFrom),a?.dateTo&&b.append("dateTo",a.dateTo),a?.status&&b.append("status",a.status);let c=await fetch(`${e}/trucks/export/excel?${b}`,{credentials:"include"});if(!c.ok)throw Error("Failed to export");let d=await c.blob(),f=window.URL.createObjectURL(d),g=document.createElement("a");g.href=f,g.download=`trucks-${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(f),document.body.removeChild(g)}};var g=a.i(19238),h=a.i(35321),i=a.i(60782);let j=(0,a.i(33953).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var k=a.i(63893),l=a.i(98414);function m(){let[a,e]=(0,c.useState)([]),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(1),[s,t]=(0,c.useState)(1),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)({identifier:"",arrival_date:"",status:"pending",notes:"",metrics:[]});(0,c.useEffect)(()=>{I(),J()},[q,u,w,y,A]);let I=async()=>{try{p(!0);let a=await f.getTrucks(q,10,{identifier:u,dateFrom:w,dateTo:y,status:A,sortBy:"arrival_date",order:"DESC"});e(a.data),t(a.pagination.pages)}catch(a){console.error("Error loading trucks:",a)}finally{p(!1)}},J=async()=>{try{let a=await f.getAnalyticsSummary();n(a.data)}catch(a){console.error("Error loading analytics:",a)}},K=a=>{a?(F(a.id),H({identifier:a.identifier,arrival_date:a.arrival_date,status:a.status,notes:a.notes||"",metrics:a.metrics||[]})):(F(null),H({identifier:"",arrival_date:"",status:"pending",notes:"",metrics:[]})),D(!0)},L=async a=>{a.preventDefault();try{E?(await f.updateTruck(E,G),alert("Фура обновлена")):(await f.createTruck(G),alert("Фура добавлена")),D(!1),r(1),I(),J()}catch(a){console.error("Error submitting:",a),alert("Ошибка при сохранении: "+(a instanceof Error?a.message:"Unknown error"))}},M=async a=>{if(confirm("Вы уверены, что хотите удалить эту фуру?"))try{await f.deleteTruck(a),alert("Фура удалена"),I(),J()}catch(a){console.error("Error deleting:",a),alert("Ошибка при удалении")}},N=(a,b,c)=>{let d=[...G.metrics];d[a]={...d[a],[b]:c},H({...G,metrics:d})};return(0,b.jsxs)(d.DashboardLayout,{title:"Анализ фур",requiredRole:"admin",children:[m&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Всего фур"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:m.total_trucks})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Доставлено"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-1",children:m.delivered})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"В пути"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:m.in_transit})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"})})})]})}),(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Задержано"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-red-600 mt-1",children:m.delayed})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 mb-4",children:[(0,b.jsx)(h.Input,{placeholder:"Поиск по ID фуры...",value:u,onChange:a=>v(a.target.value),className:"max-w-xs"}),(0,b.jsx)(h.Input,{type:"date",value:w,onChange:a=>x(a.target.value),className:"max-w-xs"}),(0,b.jsx)(h.Input,{type:"date",value:y,onChange:a=>z(a.target.value),className:"max-w-xs"}),(0,b.jsxs)("select",{value:A,onChange:a=>B(a.target.value),className:"px-3 py-2 border border-input rounded-md bg-background",children:[(0,b.jsx)("option",{value:"",children:"Все статусы"}),(0,b.jsx)("option",{value:"pending",children:"Ожидание"}),(0,b.jsx)("option",{value:"in_transit",children:"В пути"}),(0,b.jsx)("option",{value:"delivered",children:"Доставлена"}),(0,b.jsx)("option",{value:"delayed",children:"Задержана"})]}),(0,b.jsx)(g.Button,{onClick:()=>{v(""),x(""),z(""),B(""),r(1)},variant:"outline",children:"Очистить"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{onClick:()=>K(),className:"bg-green-600 hover:bg-green-700",children:[(0,b.jsx)(k.Plus,{className:"w-4 h-4 mr-2"}),"Добавить фуру"]}),(0,b.jsxs)(g.Button,{onClick:()=>f.exportToExcel({identifier:u,dateFrom:w,dateTo:y,status:A}),variant:"outline",children:[(0,b.jsx)(l.Download,{className:"w-4 h-4 mr-2"}),"Экспорт в Excel"]})]})]}),(0,b.jsx)("div",{className:"space-y-4",children:o?(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center text-gray-500",children:"Загрузка..."}):0===a.length?(0,b.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center text-gray-500",children:"Фуры не найдены"}):a.map(a=>{var c;return(0,b.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,b.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-start justify-between gap-4 mb-4",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:["Фура #",a.identifier]}),(0,b.jsx)("span",{className:`px-2 py-1 text-xs rounded-full ${{pending:"bg-yellow-100 text-yellow-700",in_transit:"bg-blue-100 text-blue-700",delivered:"bg-green-100 text-green-700",delayed:"bg-red-100 text-red-700"}[a.status]||"bg-gray-100 text-gray-700"}`,children:{pending:"Ожидание",in_transit:"В пути",delivered:"Доставлена",delayed:"Задержана"}[c=a.status]||c})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Дата прибытия:"," ",new Date(a.arrival_date).toLocaleDateString("ru-RU")]}),a.notes&&(0,b.jsxs)("p",{className:"text-sm text-blue-600 mt-1",children:["Примечание: ",a.notes]}),a.created_by_name&&(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Создано: ",a.created_by_name]})]})}),a.metrics&&a.metrics.length>0&&(0,b.jsxs)("div",{className:"border-t border-gray-100 pt-4 mb-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Показатели:"}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:a.metrics.map((a,c)=>(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsxs)("span",{className:"text-gray-600",children:[a.name,": ",(0,b.jsx)("strong",{children:a.value})," ",a.unit||""]})},c))})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-100",children:[(0,b.jsxs)(g.Button,{size:"sm",onClick:()=>K(a),variant:"outline",className:"text-blue-600 border-blue-600",children:[(0,b.jsx)(j,{className:"w-4 h-4 mr-2"}),"Редактировать"]}),(0,b.jsxs)(g.Button,{size:"sm",onClick:()=>M(a.id),variant:"outline",className:"text-red-600 border-red-600",children:[(0,b.jsx)(i.Trash2,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]},a.id)})}),s>1&&(0,b.jsxs)("div",{className:"flex justify-center gap-2 mt-6",children:[(0,b.jsx)(g.Button,{onClick:()=>r(Math.max(1,q-1)),disabled:1===q,variant:"outline",children:"◀ Назад"}),(0,b.jsxs)("span",{className:"px-4 py-2 text-sm",children:["Страница ",q," из ",s]}),(0,b.jsx)(g.Button,{onClick:()=>r(Math.min(s,q+1)),disabled:q===s,variant:"outline",children:"Далее ▶"})]}),C&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:E?"Редактировать фуру":"Новая фура"}),(0,b.jsx)("button",{onClick:()=>D(!1),className:"text-gray-500 hover:text-gray-700 text-2xl leading-none",children:"✕"})]}),(0,b.jsxs)("form",{onSubmit:L,className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ID фуры *"}),(0,b.jsx)(h.Input,{type:"text",required:!0,value:G.identifier,onChange:a=>H({...G,identifier:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Дата прибытия *"}),(0,b.jsx)(h.Input,{type:"date",required:!0,value:G.arrival_date,onChange:a=>H({...G,arrival_date:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Статус *"}),(0,b.jsxs)("select",{required:!0,value:G.status,onChange:a=>H({...G,status:a.target.value}),className:"w-full px-3 py-2 border border-input rounded-md bg-background",children:[(0,b.jsx)("option",{value:"pending",children:"Ожидание"}),(0,b.jsx)("option",{value:"in_transit",children:"В пути"}),(0,b.jsx)("option",{value:"delivered",children:"Доставлена"}),(0,b.jsx)("option",{value:"delayed",children:"Задержана"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Примечания"}),(0,b.jsx)("textarea",{value:G.notes,onChange:a=>H({...G,notes:a.target.value}),className:"w-full px-3 py-2 border border-input rounded-md min-h-24 resize-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Показатели доставки"}),(0,b.jsx)("div",{className:"space-y-3 mb-3",children:G.metrics.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-2",children:[(0,b.jsx)(h.Input,{type:"text",placeholder:"Название (кол-во, ассортимент...)",value:a.name,onChange:a=>N(c,"name",a.target.value)}),(0,b.jsx)(h.Input,{type:"text",placeholder:"Значение",value:a.value,onChange:a=>N(c,"value",a.target.value)}),(0,b.jsx)(h.Input,{type:"text",placeholder:"Единица (шт, кг...)",value:a.unit,onChange:a=>N(c,"unit",a.target.value)})]}),(0,b.jsx)(g.Button,{type:"button",size:"sm",onClick:()=>{H({...G,metrics:G.metrics.filter((a,b)=>b!==c)})},variant:"outline",className:"text-red-600 border-red-600",children:"Удалить показатель"})]},c))}),(0,b.jsxs)(g.Button,{type:"button",onClick:()=>{H({...G,metrics:[...G.metrics,{name:"",value:"",unit:""}]})},variant:"outline",className:"w-full",children:[(0,b.jsx)(k.Plus,{className:"w-4 h-4 mr-2"}),"Добавить показатель"]})]}),(0,b.jsxs)("div",{className:"flex gap-2 justify-end pt-4 border-t border-gray-200",children:[(0,b.jsx)(g.Button,{type:"button",onClick:()=>D(!1),variant:"outline",children:"Отмена"}),(0,b.jsx)(g.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:E?"Сохранить":"Создать"})]})]})]})})]})}a.s(["default",()=>m],12816)}];

//# sourceMappingURL=sdfg_app_admin_trucks_page_tsx_f4478be1._.js.map