module.exports=[54678,a=>{"use strict";var b=a.i(15477),c=a.i(47519),d=a.i(63183),e=a.i(82383),f=a.i(72063),g=a.i(19238),h=a.i(35321),i=a.i(54323),j=a.i(88491),k=a.i(22800),l=a.i(62490),m=a.i(63893),n=a.i(98414),o=a.i(60782),p=a.i(79197),q=a.i(96781),r=a.i(36086),s=a.i(47781),t=a.i(23649);let u=(0,a.i(33953).default)("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var v=a.i(43438);function w(){let{user:a}=(0,d.useAuth)(),w=(0,e.useRouter)(),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)("list"),[H,I]=(0,c.useState)({batchDate:new Date().toISOString().split("T")[0],supplierName:"",notes:"",items:[]}),[J,K]=(0,c.useState)({productName:"",category:"",color:"",variety:"",quantity:0,purchasePrice:0,sellingPrice:0,stemLength:"",packagingType:"",plantationCountry:"Китай",notes:""}),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&["admin","worker"].includes(a.role)?P():w.push("/auth/login")},[a]);let P=async()=>{try{A(!0);let b=await f.api.getInventoryBatches({userId:a?.id});b.success&&y(b.batches)}catch(a){console.error("Error loading batches:",a)}finally{A(!1)}},Q=async a=>{try{let b=await f.api.getInventoryBatch(a);b.success&&(E(b),G("details"))}catch(a){console.error("Error loading batch details:",a)}},R=async()=>{try{let[a,b]=await Promise.all([f.api.getInventoryByCategory({}),f.api.getInventoryPriceComparison({})]);a.success&&M(a.data),b.success&&O(b.data),G("analytics")}catch(a){console.error("Error loading analytics:",a)}},S=async()=>{if(0===H.items.length)return void alert("Добавьте хотя бы один товар в партию");try{let b=await f.api.createInventoryBatch({userId:a.id,batchDate:H.batchDate,supplierName:H.supplierName,notes:H.notes,items:H.items});b.success&&(alert(`Партия создана! Всего ${b.totalItems} единиц на сумму ${b.totalCost} тг`),C(!1),I({batchDate:new Date().toISOString().split("T")[0],supplierName:"",notes:"",items:[]}),P())}catch(a){console.error("Error creating batch:",a),alert("Ошибка при создании партии")}},T=async a=>{try{let b=await f.api.exportInventoryCSV({batchId:a});if(console.log("Export response type:",typeof b),console.log("Export response:",b?.substring?b.substring(0,100):b),b){if("object"==typeof b){console.error("Export returned object instead of CSV text:",b),alert(b.message||"Нет данных для экспорта");return}let c=new Blob([b],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download=`inventory_${a||"all"}_${new Date().toISOString().split("T")[0]}.csv`,d.click()}}catch(a){console.error("Export error:",a),alert("Ошибка при экспорте")}},U=async(b,c)=>{try{(await f.api.updateInventoryBatch(b,{userId:a.id,status:c})).success&&(P(),D?.batch?.id===b&&Q(b))}catch(a){console.error("Error updating status:",a)}},V=a=>(0,b.jsx)(l.Badge,{className:{draft:"bg-gray-100 text-gray-800",received:"bg-green-100 text-green-800",processed:"bg-blue-100 text-blue-800"}[a],children:{draft:"Черновик",received:"Получено",processed:"Обработано"}[a]});return z?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-[#568a56] border-t-transparent rounded-full"})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,b.jsx)("div",{className:"bg-white border-b",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(v.default,{href:"/admin",className:"text-gray-600 hover:text-gray-900",children:(0,b.jsx)(t.ChevronLeft,{className:"h-6 w-6"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Управление поставками"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Еженедельный учет товаров"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>G("list"),children:[(0,b.jsx)(q.Package,{className:"h-4 w-4 mr-2"}),"Партии"]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:R,children:[(0,b.jsx)(r.TrendingUp,{className:"h-4 w-4 mr-2"}),"Аналитика"]}),(0,b.jsxs)(g.Button,{onClick:()=>T(),children:[(0,b.jsx)(n.Download,{className:"h-4 w-4 mr-2"}),"Экспорт всего"]}),(0,b.jsxs)(k.Dialog,{open:B,onOpenChange:C,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"bg-[#568a56] hover:bg-[#467046]",children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Новая партия"]})}),(0,b.jsxs)(k.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(k.DialogHeader,{children:(0,b.jsx)(k.DialogTitle,{children:"Создание партии поставки"})}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Дата поставки"}),(0,b.jsx)(h.Input,{type:"date",value:H.batchDate,onChange:a=>I(b=>({...b,batchDate:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Поставщик"}),(0,b.jsx)(h.Input,{placeholder:"Название поставщика",value:H.supplierName,onChange:a=>I(b=>({...b,supplierName:a.target.value}))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Примечания"}),(0,b.jsx)(h.Input,{placeholder:"Примечания к партии",value:H.notes,onChange:a=>I(b=>({...b,notes:a.target.value}))})]})]}),(0,b.jsxs)(i.Card,{className:"mb-4",children:[(0,b.jsx)(i.CardHeader,{className:"py-3",children:(0,b.jsx)(i.CardTitle,{className:"text-sm",children:"Добавить товар"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-3 mb-3",children:[(0,b.jsx)(h.Input,{placeholder:"Название *",value:J.productName,onChange:a=>K(b=>({...b,productName:a.target.value}))}),(0,b.jsx)(h.Input,{placeholder:"Категория",value:J.category,onChange:a=>K(b=>({...b,category:a.target.value}))}),(0,b.jsx)(h.Input,{placeholder:"Цвет",value:J.color,onChange:a=>K(b=>({...b,color:a.target.value}))}),(0,b.jsx)(h.Input,{placeholder:"Сорт",value:J.variety,onChange:a=>K(b=>({...b,variety:a.target.value}))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-5 gap-3 mb-3",children:[(0,b.jsx)(h.Input,{type:"number",placeholder:"Кол-во *",value:J.quantity||"",onChange:a=>K(b=>({...b,quantity:Number(a.target.value)}))}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",placeholder:"Закуп. цена *",value:J.purchasePrice||"",onChange:a=>K(b=>({...b,purchasePrice:Number(a.target.value)}))}),(0,b.jsx)(h.Input,{type:"number",step:"0.01",placeholder:"Продаж. цена",value:J.sellingPrice||"",onChange:a=>K(b=>({...b,sellingPrice:Number(a.target.value)}))}),(0,b.jsx)(h.Input,{placeholder:"Длина стебля",value:J.stemLength,onChange:a=>K(b=>({...b,stemLength:a.target.value}))}),(0,b.jsx)(h.Input,{placeholder:"Страна",value:J.plantationCountry,onChange:a=>K(b=>({...b,plantationCountry:a.target.value}))})]}),(0,b.jsxs)(g.Button,{onClick:()=>{!J.productName||J.quantity<=0||J.purchasePrice<=0?alert("Заполните обязательные поля: название, количество и закупочную цену"):(I(a=>({...a,items:[...a.items,{...J}]})),K({productName:"",category:"",color:"",variety:"",quantity:0,purchasePrice:0,sellingPrice:0,stemLength:"",packagingType:"",plantationCountry:"Китай",notes:""}))},className:"w-full",children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Добавить в партию"]})]})]}),H.items.length>0&&(0,b.jsxs)("div",{className:"border rounded-lg overflow-hidden mb-4",children:[(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Название"}),(0,b.jsx)(j.TableHead,{children:"Категория"}),(0,b.jsx)(j.TableHead,{children:"Кол-во"}),(0,b.jsx)(j.TableHead,{children:"Закуп. цена"}),(0,b.jsx)(j.TableHead,{children:"Сумма"}),(0,b.jsx)(j.TableHead,{})]})}),(0,b.jsx)(j.TableBody,{children:H.items.map((a,c)=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.productName}),(0,b.jsx)(j.TableCell,{children:a.category}),(0,b.jsx)(j.TableCell,{children:a.quantity}),(0,b.jsxs)(j.TableCell,{children:[a.purchasePrice," тг"]}),(0,b.jsxs)(j.TableCell,{children:[(a.quantity*a.purchasePrice).toLocaleString()," ","тг"]}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>{I(a=>({...a,items:a.items.filter((a,b)=>b!==c)}))},children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4 text-red-500"})})})]},c))})]}),(0,b.jsx)("div",{className:"p-3 bg-gray-50 border-t",children:(0,b.jsxs)("div",{className:"flex justify-between font-medium",children:[(0,b.jsxs)("span",{children:["Итого:"," ",H.items.reduce((a,b)=>a+b.quantity,0)," ","единиц"]}),(0,b.jsxs)("span",{children:["Сумма:"," ",H.items.reduce((a,b)=>a+b.quantity*b.purchasePrice,0).toLocaleString()," ","тг"]})]})})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>C(!1),children:"Отмена"}),(0,b.jsx)(g.Button,{onClick:S,className:"bg-[#568a56] hover:bg-[#467046]",children:"Создать партию"})]})]})]})]})]})})}),(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:["list"===F&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x.length}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Всего партий"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x.reduce((a,b)=>a+b.total_items,0).toLocaleString()}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Единиц товара"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[x.reduce((a,b)=>a+Number(b.total_cost),0).toLocaleString()," ","тг"]}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Общая сумма"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x.filter(a=>"draft"===a.status).length}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Черновиков"})]})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Партии поставок"})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Дата"}),(0,b.jsx)(j.TableHead,{children:"Поставщик"}),(0,b.jsx)(j.TableHead,{children:"Товаров"}),(0,b.jsx)(j.TableHead,{children:"Единиц"}),(0,b.jsx)(j.TableHead,{children:"Сумма"}),(0,b.jsx)(j.TableHead,{children:"Статус"}),(0,b.jsx)(j.TableHead,{children:"Создал"}),(0,b.jsx)(j.TableHead,{children:"Действия"})]})}),(0,b.jsx)(j.TableBody,{children:x.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{children:new Date(a.batch_date).toLocaleDateString("ru-RU")}),(0,b.jsx)(j.TableCell,{children:a.supplier_name||"-"}),(0,b.jsx)(j.TableCell,{children:a.items_count}),(0,b.jsx)(j.TableCell,{children:a.total_items}),(0,b.jsxs)(j.TableCell,{children:[Number(a.total_cost).toLocaleString()," тг"]}),(0,b.jsx)(j.TableCell,{children:V(a.status)}),(0,b.jsx)(j.TableCell,{children:a.created_by_name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>Q(a.id),children:(0,b.jsx)(p.Eye,{className:"h-4 w-4"})}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>T(a.id),children:(0,b.jsx)(u,{className:"h-4 w-4"})}),"draft"===a.status&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>U(a.id,"received"),className:"text-green-600",children:"✓"})]})})]},a.id))})]})})]})]}),"details"===F&&D&&(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>G("list"),className:"mb-4",children:[(0,b.jsx)(t.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Назад к списку"]}),(0,b.jsxs)(i.Card,{className:"mb-4",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)(i.CardTitle,{children:["Партия от"," ",new Date(D.batch.batch_date).toLocaleDateString("ru-RU")]}),V(D.batch.status)]})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Поставщик"}),(0,b.jsx)("div",{className:"font-medium",children:D.batch.supplier_name||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Всего единиц"}),(0,b.jsx)("div",{className:"font-medium",children:D.batch.total_items})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Общая сумма"}),(0,b.jsxs)("div",{className:"font-medium",children:[Number(D.batch.total_cost).toLocaleString()," ","тг"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Создал"}),(0,b.jsx)("div",{className:"font-medium",children:D.batch.created_by_name})]})]}),"draft"===D.batch.status&&(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(g.Button,{onClick:()=>U(D.batch.id,"received"),className:"bg-green-600 hover:bg-green-700",children:"Подтвердить получение"})})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{children:["Товары в партии (",D.items.length,")"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Название"}),(0,b.jsx)(j.TableHead,{children:"Категория"}),(0,b.jsx)(j.TableHead,{children:"Цвет"}),(0,b.jsx)(j.TableHead,{children:"Сорт"}),(0,b.jsx)(j.TableHead,{children:"Кол-во"}),(0,b.jsx)(j.TableHead,{children:"Закуп. цена"}),(0,b.jsx)(j.TableHead,{children:"Продаж. цена"}),(0,b.jsx)(j.TableHead,{children:"Сумма"})]})}),(0,b.jsx)(j.TableBody,{children:D.items.map(a=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.product_name}),(0,b.jsx)(j.TableCell,{children:a.category||"-"}),(0,b.jsx)(j.TableCell,{children:a.color||"-"}),(0,b.jsx)(j.TableCell,{children:a.variety||"-"}),(0,b.jsx)(j.TableCell,{children:a.quantity}),(0,b.jsxs)(j.TableCell,{children:[Number(a.purchase_price).toFixed(2)," тг"]}),(0,b.jsx)(j.TableCell,{children:a.selling_price?Number(a.selling_price).toFixed(2)+" тг":"-"}),(0,b.jsxs)(j.TableCell,{children:[(a.quantity*Number(a.purchase_price)).toLocaleString()," ","тг"]})]},a.id))})]})})]})]}),"analytics"===F&&(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>G("list"),className:"mb-4",children:[(0,b.jsx)(t.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Назад к списку"]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Аналитика по категориям"})}),(0,b.jsx)(i.CardContent,{children:L&&L.length>0?(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Категория"}),(0,b.jsx)(j.TableHead,{children:"Товаров"}),(0,b.jsx)(j.TableHead,{children:"Единиц"}),(0,b.jsx)(j.TableHead,{children:"Сумма"}),(0,b.jsx)(j.TableHead,{children:"Ср. цена"})]})}),(0,b.jsx)(j.TableBody,{children:L.map((a,c)=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.category||"Без категории"}),(0,b.jsx)(j.TableCell,{children:a.products_count}),(0,b.jsx)(j.TableCell,{children:Number(a.total_quantity).toLocaleString()}),(0,b.jsxs)(j.TableCell,{children:[Number(a.total_cost).toLocaleString()," тг"]}),(0,b.jsxs)(j.TableCell,{children:[Number(a.avg_purchase_price).toFixed(2)," тг"]})]},c))})]}):(0,b.jsx)("p",{className:"text-gray-500",children:"Нет данных для анализа"})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Изменения цен"})}),(0,b.jsx)(i.CardContent,{children:N&&N.length>0?(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.filter(a=>a.price_change).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.product_name}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:new Date(a.batch_date).toLocaleDateString("ru-RU")})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm",children:[Number(a.purchase_price).toFixed(2)," тг"]}),Number(a.price_change)>0?(0,b.jsxs)(l.Badge,{className:"bg-red-100 text-red-800",children:[(0,b.jsx)(r.TrendingUp,{className:"h-3 w-3 mr-1"}),"+",a.price_change,"%"]}):(0,b.jsxs)(l.Badge,{className:"bg-green-100 text-green-800",children:[(0,b.jsx)(s.TrendingDown,{className:"h-3 w-3 mr-1"}),a.price_change,"%"]})]})]},c))}):(0,b.jsx)("p",{className:"text-gray-500",children:"Нет данных об изменениях цен"})})]})]})]})]})]})}a.s(["default",()=>w],54678)}];

//# sourceMappingURL=sdfg_app_admin_inventory_page_tsx_e7c4259b._.js.map